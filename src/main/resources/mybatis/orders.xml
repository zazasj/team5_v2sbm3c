<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "dev.mvc.orders.OrdersDAOInter">

  <!-- resultMap 정의 -->
  <resultMap id="OrdersResultMap" type="dev.mvc.orders.OrdersVO">
    <id column="OrderID" property="OrderID"/>
    <result column="memberno" property="memberno"/>
    <result column="OrderDate" property="OrderDate"/>
    <result column="ProductID" property="ProductID"/>
    <!-- 추가된 컬럼들에 대한 resultMap -->
    <result column="Price" property="Price"/>
  </resultMap>
  
  <!-- return : 등록한 레코드 갯수를 1을 리턴, parameterType : 전달받는 데이터 -->
  <insert id="create" parameterType="dev.mvc.orders.OrdersVO">
    <!-- Orders 테이블에 새로운 데이터 추가 -->
    INSERT INTO Orders (OrderID, memberno, OrderDate, ProductID)
    VALUES (orders_seq.nextval, #{memberno}, sysdate, #{ProductID});

    <!-- Product 테이블에서 Price 컬럼 내용 불러오기 -->
    UPDATE Orders SET Price = (SELECT Price FROM Product WHERE ProductID = #{ProductID}) WHERE OrderID = (SELECT max(OrderID) FROM Orders WHERE memberno = #{memberno});
    
  </insert>
  
</mapper> 